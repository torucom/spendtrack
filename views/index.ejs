<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendTrack</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
<header>
    <h1>SpendTrack</h1>
    <p>こんにちは、<%= user.name %> さん</p>
    <form action="/logout" method="POST">
        <button type="submit">ログアウト</button>
    </form>
    <% if (user.role === "admin") { %>
        <button onclick="location.href='/manage-users'">ユーザー管理</button>
    <% } %>
</header>

<!-- 年ナビゲーション -->
<div class="year-navigation">
    <a href="/?year=<%= previousYear %>&month=<%= selectedMonth %>"><< 前年</a>
    <span><strong><%= selectedYear %></strong> 年</span>
    <a href="/?year=<%= nextYear %>&month=<%= selectedMonth %>">翌年 >></a>
</div>

<!-- 月別リスト -->
<div class="month-list">
    <% monthList.forEach(({ month, active }) => { %>
        <a href="/?year=<%= selectedYear %>&month=<%= month %>"
           class="month-button <%= selectedMonth === month ? 'current-month' : '' %> <%= active ? '' : 'inactive' %>">
            <%= month %>月
        </a>
    <% }) %>
</div>

<!-- 経費一覧 -->
<section>
    <h2>経費一覧</h2>
    <% if (!expenses || expenses.length === 0) { %>
        <p>登録された経費がありません。</p>
    <% } else { %>
        <table>
            <thead>
            <tr>
                <th>日付</th>
                <th>説明</th>
                <th>金額</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <% expenses.forEach(expense => { %>
                <tr>
                    <td><%= expense.date %></td>
                    <td><%= expense.description %></td>
                    <td><%= Number(expense.amount).toLocaleString('ja-JP') %>円</td>
                    <td>
                        <a href="/expenses/edit/<%= expense.id %>">
                            <button type="button">編集</button>
                        </a>
                        <form action="/expenses/delete" method="POST">
                            <input type="hidden" name="id" value="<%= expense.id %>">
                            <button type="submit" onclick="return confirm('本当に削除しますか？')">削除</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
            </tbody>
            <tfoot>
            <tr>
                <td colspan="2"><strong>合計</strong></td>
                <td colspan="2"><strong><%= Number(totalExpenses).toLocaleString('ja-JP') %> 円</strong></td>
            </tr>
            <tr>
                <td colspan="2"><strong>月の予算</strong></td>
                <td colspan="2"><strong><%= Number(currentBudget).toLocaleString('ja-JP') %> 円</strong></td>
            </tr>
            <tr>
                <td colspan="2"><strong>残り予算</strong></td>
                <% if (remainingBudget < 0) { %>
                    <td colspan="2" style="color: red;"><strong>オーバー: <%= Math.abs(remainingBudget).toLocaleString('ja-JP') %> 円</strong></td>
                <% } else { %>
                    <td colspan="2"><strong><%= Number(remainingBudget).toLocaleString('ja-JP') %> 円</strong></td>
                <% } %>
            </tr>
            </tfoot>
        </table>
    <% } %>
</section>

<!-- 経費追加フォーム -->
<section>
    <h2>経費登録</h2>
    <form action="/expenses/add" method="POST">
        <label for="date">日付:</label>
        <input type="date" id="date" name="date" required>

        <label for="description">説明:</label>
        <input type="text" id="description" name="description" required>

        <label for="amount">金額:</label>
        <input type="number" id="amount" name="amount" required>

        <button type="submit">追加</button>
    </form>
</section>

<!-- 予算設定 -->
<section>
    <h2>予算設定</h2>
    <form action="/budget/set" method="POST">
        <input type="hidden" name="year" value="<%= selectedYear %>">
        <input type="hidden" name="month" value="<%= selectedMonth %>">
        <label for="budget">月の予算 (円):</label>
        <input type="number" name="amount" id="budget" value="<%= budget[selectedYear + '-' + selectedMonth] || '' %>" required>
        <button type="submit">設定</button>
    </form>
</section>

</body>
</html>